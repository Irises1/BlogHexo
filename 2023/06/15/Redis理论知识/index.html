<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Redis的认识Redis介绍开源的内存数据结构存储，用作数据库，缓存，消息代理和流引擎。 提供了数据结构例如字符串，散列，列表，集合，带范围查询的排序集合，位图，超日志，地理空间索引和流，对这些数据类型的操作都是原子性的 内置了赋值，Lua脚本，LRU驱逐，事务，多种集群方案（主从复制，哨兵，切片机），发布订阅模式，内存淘汰机制，过期删除机制和不同级别的磁盘持久性 为什么用Redis做MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2023/06/15/Redis%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Redis的认识Redis介绍开源的内存数据结构存储，用作数据库，缓存，消息代理和流引擎。 提供了数据结构例如字符串，散列，列表，集合，带范围查询的排序集合，位图，超日志，地理空间索引和流，对这些数据类型的操作都是原子性的 内置了赋值，Lua脚本，LRU驱逐，事务，多种集群方案（主从复制，哨兵，切片机），发布订阅模式，内存淘汰机制，过期删除机制和不同级别的磁盘持久性 为什么用Redis做MySQL">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:\Users\Bubble\AppData\Roaming\Typora\typora-user-images\image-20230615111102495.png">
<meta property="article:published_time" content="2023-06-15T12:12:02.382Z">
<meta property="article:modified_time" content="2023-06-15T03:11:25.743Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\Bubble\AppData\Roaming\Typora\typora-user-images\image-20230615111102495.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Redis理论知识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/06/15/Redis%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2023-06-15T12:12:02.382Z" itemprop="datePublished">2023-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redis的认识"><a href="#Redis的认识" class="headerlink" title="Redis的认识"></a>Redis的认识</h1><h2 id="Redis介绍"><a href="#Redis介绍" class="headerlink" title="Redis介绍"></a>Redis介绍</h2><p>开源的<strong>内存数据结构存储</strong>，用作数据库，缓存，消息代理和流引擎。</p>
<p>提供了数据结构例如字符串，散列，列表，集合，带范围查询的排序集合，位图，超日志，地理空间索引和流，对这些数据类型的操作都是原子性的</p>
<p>内置了赋值，Lua脚本，LRU驱逐，事务，多种集群方案（主从复制，哨兵，切片机），发布订阅模式，内存淘汰机制，过期删除机制和不同级别的磁盘持久性</p>
<h2 id="为什么用Redis做MySQL缓存"><a href="#为什么用Redis做MySQL缓存" class="headerlink" title="为什么用Redis做MySQL缓存"></a>为什么用Redis做MySQL缓存</h2><ol>
<li><p>Redis具备高性能</p>
<p>Redis直接操作内存，速度相当快</p>
</li>
<li><p>Redis具备高并发</p>
<p>单台设备QPS是SQL十倍</p>
</li>
</ol>
<h1 id="Redis数据结构"><a href="#Redis数据结构" class="headerlink" title="Redis数据结构"></a>Redis数据结构</h1><p>常见数据类型和使用场景</p>
<ul>
<li>String：缓存对象，常规计数，分布式锁，共享session信息</li>
<li>List：消息队列（有一定问题：生产者需要自行实现全局唯一id，不能消费组形式消费数据）</li>
<li>Hash：缓存对象，购物车</li>
<li>Set：聚合计算（交集，并集，差集等），点赞，共同关注，抽象活动</li>
<li>Zset：排序场景，排行榜，电话姓名等</li>
<li>BitMap：二值状态统计，签到，用户登陆状态，连续签到用户等</li>
<li>HyperLogLog：海量数据基数统计的场景，比如百万级的网页UV计数</li>
<li>GEO：存储地理位置信息</li>
<li>Stream：消息队列，可以自动生成全局唯一消息ID，支持以消费组形式消费数据</li>
</ul>
<h1 id="Redis线程模型"><a href="#Redis线程模型" class="headerlink" title="Redis线程模型"></a>Redis线程模型</h1><p>Redis是单线程，指Redis的[接收客户端请求-&gt;解析请求-&gt;进行数据读写等操作-&gt;发送数据给客户端]这一个过程都是由一个主线程来完成的。</p>
<p>但是Redis并不是单线程，在启动时还会启动后台进程：</p>
<ul>
<li>处理关闭文件</li>
<li>AOF刷盘</li>
<li>异步释放Redis内存的Lazyfree线程</li>
</ul>
<p>因为这些内存都比较耗时</p>
<h2 id="为什么Redis单线程还很快"><a href="#为什么Redis单线程还很快" class="headerlink" title="为什么Redis单线程还很快"></a>为什么Redis单线程还很快</h2><ul>
<li>Redis的大部分操作都在内存中完成，且使用高效的数据结构。所以Redis的瓶颈是机器内存或者网络带宽而不是CPU</li>
<li>单线程可以避免多线程的竞争，省去多线程切换带来的时间和性能上的开销，也不会出现死锁</li>
<li>采用I&#x2F;O多路复用机制处理大量客户端Socket请求。即一个线程处理多个IO流</li>
</ul>
<h2 id="为什么Redis6-0之后引入多线程"><a href="#为什么Redis6-0之后引入多线程" class="headerlink" title="为什么Redis6.0之后引入多线程"></a>为什么Redis6.0之后引入多线程</h2><p>因为随着网络硬件性能提升，Redis性能瓶颈会出现在网络I&#x2F;O处理上，为了提高网络I&#x2F;O并行度，Redis采用多线程，但是对于命令的执行还是使用单线程</p>
<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><p>三种持久化方式：AOF日志，RDB快照，混合持久化方式</p>
<h2 id="AOF日志"><a href="#AOF日志" class="headerlink" title="AOF日志"></a>AOF日志</h2><p>Redis执行一条写操作，就把命令以追加的方式写到一个文件中，当Redis重启会读取文件记录命令逐一执行来恢复数据</p>
<h3 id="为什么先执行命令再写入日志"><a href="#为什么先执行命令再写入日志" class="headerlink" title="为什么先执行命令再写入日志"></a>为什么先执行命令再写入日志</h3><p>好处</p>
<ul>
<li>避免额外检查开销：错误的命令无法执行，执行了命令保证语法通过</li>
<li>不会阻塞当前写操作命令的执行</li>
</ul>
<p>风险</p>
<ul>
<li>数据可能丢失，如果执行了命令还没来得及写入日志服务器宕机，数据就有丢失风险</li>
<li>可能阻塞其他操作：写操作执行成功才记录到AOF，不会阻塞当前命令。但是AOF日志也在主线程执行，写入磁盘时会阻塞后续操作</li>
</ul>
<h3 id="AOF写回策略"><a href="#AOF写回策略" class="headerlink" title="AOF写回策略"></a>AOF写回策略</h3><p>Redis写入AOF日志可以概括为：</p>
<ol>
<li>Redis执行写操作，将命令追加到server.aof_buf缓冲区</li>
<li>通过write()系统调用，写入AOF文件，还没写入到硬盘，拷贝到了内核缓冲区page cache，等待内核将数据写入硬盘</li>
<li>具体内核缓冲区数据什么时候写入硬盘由内核决定</li>
</ol>
<p>写回策略就是这里第三步什么时候写入硬盘</p>
<p><img src="C:\Users\Bubble\AppData\Roaming\Typora\typora-user-images\image-20230615111102495.png" alt="image-20230615111102495"></p>
<p>三种写回策略的优缺点</p>
<h2 id="RDB快照"><a href="#RDB快照" class="headerlink" title="RDB快照"></a>RDB快照</h2><h2 id="混合持久化方式"><a href="#混合持久化方式" class="headerlink" title="混合持久化方式"></a>混合持久化方式</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/06/15/Redis%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/" data-id="clix3qjvk0005qwue47pd77l6" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/06/15/Spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/06/15/Redis%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98-%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/06/15/sam%20related%20note/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/06/15/Sam%20on%20tooth/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/06/15/nnUNetv2%E7%AC%94%E8%AE%B0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/06/15/MedNeXt%20Transformer-driven%20Scaling%20of%20ConvNets%20for%20Medical%20Image%20Segmentation/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/06/15/%E5%BC%82%E4%BD%8D%E8%90%8C%E5%87%BA%E4%BB%BB%E5%8A%A1/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>